<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinary</title>
</head>

<body style="background-color: black;">
    <script>
        function User(id, name, surname, username, password, role) {
            this.id = id
            this.name = name
            this.surname = surname
            this.username = username
            this.password = password
            this.role = role
        }

        function Vaccine(id, name, description) {
            this.id = id
            this.name = name
            this.description = description
        }

        function Owner(id, name, surname, address, phone, email) {
            this.id = id
            this.name = name
            this.surname = surname
            this.address = address
            this.phone = phone
            this.email = email
            this.active = true
        }

        function Pet(ownerId, id, name, yearOfBirth, species, gender, race, colors) {
            this.ownerId = ownerId
            this.id = id
            this.name = name
            this.yearOfBirth = yearOfBirth
            this.species = species
            this.gender = gender
            this.race = race
            this.colors = colors
            this.vaccines = [] // { vaccineId: 'rst-456', expirationDate: '2026-01-01' }
        }

        Pet.prototype.saveVaccine = function (vaccineId, expirationDate) {
            this.vaccines.push({ vaccineId: vaccineId, expirationDate: expirationDate })
        }

        function Database() {
            this.users = []
            this.vaccines = []
            this.owners = []
            this.pets = []
        }

        Database.prototype.findOwnerById = function (ownerId) {
            for (let i = 0; i < this.owners.length; i++) {
                const owner = this.owners[i]

                if (owner.id === ownerId)
                    return owner
            }

            return null
        }

        Database.prototype.findPetsByOwnerId = function (ownerId) {
            const foundPets = []

            for (let i = 0; i < this.pets.length; i++) {
                const pet = this.pets[i]

                if (pet.ownerId === ownerId)
                    foundPets.push(pet)
            }

            return foundPets
        }

        Database.prototype.findPetById = function (petId) {
            for (let i = 0; i < this.pets.length; i++) {
                const pet = this.pets[i]

                if (pet.id === petId)
                    return pet
            }

            return null
        }

        Database.prototype.addUser = function (user) {
            this.users.push(user)
        }

        Database.prototype.findUserByUsername = function(username) {
            for (let i = 0; i < this.users.length; i++) {
                const user = this.users[i]

                if (user.username === username)
                    return user
            }

            return null
        }

        Database.prototype.addVaccine = function (vaccine) {
            this.vaccines.push(vaccine)
        }

        Database.prototype.addOwner = function (owner) {
            this.owners.push(owner)
        }

        Database.prototype.addPet = function (pet) {
            this.pets.push(pet)
        }

        const data = new Database()

        function Logic() {

        }

        Logic.prototype.registerUser = function(name, surname, username, password, passwordRepeat) {
            // TODO implement this method
            /*
            steps
            - validate inputs: if fields do not follow validation rules then send error "invalid field x" (rules are: type, content)
            - check if user already exists in data with given username: if user exists send error "user already exists", else add user to data)
            */

            if (typeof name !== 'string') return 'invalid name type'
            if (name.length < 1) return 'invalid name length'

            if (typeof surname !== 'string') return 'invalid surname type'
            if (surname.length < 2) return 'invalid surname length'

            if (typeof username !== 'string') return 'invalid username type'
            if (username.length < 4) return 'invalid username length'

            if (typeof password !== 'string') return 'invalid password type'
            if (password.length < 8) return 'invalid password length'

            if (typeof passwordRepeat !== 'string') return 'invalid passwordRepeat type'
            if (passwordRepeat.length < 8) return 'invalid passwordRepeat length'

            if (password !== passwordRepeat) return 'passwords do not match'

            let user = data.findUserByUsername(username)

            if (user !== null) return 'user already exists'

            user = new User('user-?', name, surname, username, password, passwordRepeat)

            data.addUser(user)
        }

        Logic.prototype.registerOwner = function(id, name, surname, address, phone, email) {
            // TODO implement me
        }

        const logic = new Logic()

        // usage

        // logic.registerUser('Peter', 'Pan', 'peterpan', '123123123', '123123123')
        // logic.registerUser('Peter', 'Pan', 'peterpan', '123123123', '123123123')

        // data.addUser(new User('user-1', 'Peter', 'Pan', 'peterpan', '123123123', 'auxiliar'))
        // data.addUser(new User('user-2', 'Wendy', 'Darling', 'wendydarling', '123123123', 'veterinary'))

        // data.addVaccine(new Vaccine('xyz-345', 'rabitis', 'blah blah blah 200mg'))
        // data.addVaccine(new Vaccine('uvw-123', 'mosquitus', 'bleh bleh bleh auch! 100mg'))
        // data.addVaccine(new Vaccine('rst-456', 'parvovirus', 'blih blih blih 300mg'))

        // data.addOwner(new Owner('123456789T', 'Laura', 'Chico', 'Mahnattan, 123', '+1(678)123456', 'laura@chico.com'))

        // data.addPet(new Pet('123456789T', 'abc-123', 'Tobías', 2023, 'canine', 'masculine', 'mix', ['black']))
        // data.addPet(new Pet('123456789T', 'def-456', 'Pelayo', 2024, 'canine', 'masculine', 'mix', ['brown', 'white']))

        // data.addOwner(new Owner('2345678980W', 'Juan', 'Indiferente', 'New Jersery, 345', '+1(786)432654', 'juan@indiferente.com'))

        // data.addPet(new Pet('2345678980W', 'ghi-789', 'Dalí', 2022, 'canine', 'masculine', 'american bully', ['gray', 'white']))
        // data.addPet(new Pet('2345678980W', 'jkl-012', 'Floki', 2017, 'feline', 'masculine', 'bombay', ['black']))
        // data.addPet(new Pet('2345678980W', 'mno-345', 'Olga', 2017, 'feline', 'feminine', 'siamese', ['gray', 'white', 'brown']))

        // data.findPetById('abc-123').saveVaccine('rst-456', '2026-01-01')
        // data.findPetById('abc-123').saveVaccine('uvw-123', '2026-02-02')
        // data.findPetById('abc-123').saveVaccine('xyz-345', '2026-11-01')

        // data.findPetById('def-456').saveVaccine('rst-456', '2026-03-03')
        // data.findPetById('def-456').saveVaccine('uvw-123', '2026-04-04')
        // data.findPetById('def-456').saveVaccine('xyz-345', '2026-11-01')

        // // const owner = database.findOwnerById('2345678980W')
        // // console.log(owner)
        // // Owner('2345678980W', 'Juan', 'Indiferente', 'New Jersery, 345', '+1(786)432654', 'juan@indiferente.com')
    </script>
</body>

</html>